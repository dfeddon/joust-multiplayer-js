"use strict";var gameport=process.env.PORT||4004,io=require("socket.io"),clientIo=require("socket.io-client"),express=require("express"),UUID=require("node-uuid"),debug=require("debug"),winston=require("winston"),verbose=!1,http=require("http"),app=express(),server=http.createServer(app),util=require("util"),WORKERS=process.env.WEB_CONCURRENCY||1;server.listen(gameport),console.log("\t :: Express :: Listening on port "+gameport),app.get("/",function(e,s){s.sendfile("/index.html",{root:__dirname})}),app.get("/app.js",function(e,s){s.status(404).end()}),app.get("/game.core.js",function(e,s){s.status(404).end()}),app.get("/game.server.js",function(e,s){s.status(404).end()}),app.get("/class.player.js",function(e,s){s.status(404).end()}),app.get("/class.chest.js",function(e,s){s.status(404).end()}),app.get("/class.flag.js",function(e,s){s.status(404).end()}),app.get("/class.toast.js",function(e,s){s.status(404).end()}),app.get("/egyptian_set.js",function(e,s){s.status(404).end()}),app.get("/package.json",function(e,s){s.status(404).end()}),app.get("/*",function(e,s,n){var t=e.params[0];console.log("\t :: Express :: file requested : "+t),s.sendfile(__dirname+"/"+t)}),app.post("/api/orbs",function(e,s,n){return console.log("api POST - app get orbs",game_server[0]),s.send("hi",game_server.games.length)}),app.post("/api/playernames",function(e,s,n){console.log("api POST - app get player names",game_server[0])});var sio=io.listen(server);sio.engine.ws=new(require("uws").Server)({noServer:!0,perMessageDeflate:!1}),sio.use(function(e,s){e.request;s()});var game_server=require("./game.server.js");sio.sockets.on("connection",function(e){console.log("client.connection"),e.userid=UUID(),console.log("@@ new client connected",e.userid),e.emit("onconnected",{id:e.userid}),game_server.findGame(e),console.log("\t socket.io:: player "+e.userid+" connected"),e.on("message",function(s){game_server.onMessage(e,s)}),e.on("disconnect",function(){console.log("\t socket.io:: client disconnected "+e.userid+" "+e.gameid),e.game&&e.game.id&&game_server.endGame(e.gameid,e.userid)})});var host=clientIo.connect(UUID());host.userid=UUID(),host.hosting=!0,game_server.createGame(host);